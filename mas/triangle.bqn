# file made only to see a triangle fuck itself up
# not related to repo, just a demonstration of me not knowing
# how to call r.draw.Triangle
âŸ¨âŸ¨white, black, red, green, blueâŸ© â‡colorâŸ©â†râ†â€¢Import "../rayed-bqn/rayed.bqn"

# translate normalized coordinates (with box x and y âˆŠ (0, 1))
# into window coordinates (I'm drawing everything in a square area)
DispCoord â† {ğ•Šnc:
    min â† âŒŠÂ´ r.window.GetSize@
    âŒŠ min Ã— nc
}

# mark the square area I'm drawing everyting in
DrawArena â† { ğ•Š@:
          min â† âŒŠÂ´ r.window.GetSize@
		  64â€¿64â€¿64â€¿255 r.draw.Rectangle [0â€¿0, minâ€¿min]
}

# normalization function for shit passed as struct of arrays
Nd â† {(âˆš+ËÃ—Ëœğ•©)âŠ¸(Ã·Ëœ)Ë˜ ğ•©}

DrawBoids â† { ğ•Šbs:
    h â† 160 # triangle height
    w â† 80 # triangle width
    x_y â† DispCoord 2â†‘bs
    ndx_dy â† Nd 2â†“bs # normalized

    tips â†  âŒŠx_y + h Ã—  ndx_dy
    left â† 	âŒŠx_y + w Ã— âŒ½ Â¯1âŠ¸Ã—âŒ¾âŠndx_dy
    right â† âŒŠx_y - w Ã— âŒ½ Â¯1âŠ¸Ã—âŒ¾âŠndx_dy

    {red r.draw.Circle ğ•©â€¿10}Ë˜ â‰tips
    {green  r.draw.Circle ğ•©â€¿10}Ë˜ â‰right
    {blue   r.draw.Circle ğ•©â€¿10}Ë˜ â‰left

    {white r.draw.Triangle(3â€¿2â¥Šğ•©)}Ë˜ â‰tipsâˆ¾leftâˆ¾right
}

Boids â† { ğ•Št:
    theta â† 2Ã—Ï€Ã— 400Ã·Ëœ 400|t
	# I'm using a struct of arrays representation for the triangles
	# so the data may be passed a bit weird between functions
	â‰â‰[0.5, 0.5, â€¢math.Sin theta, â€¢math.Cos theta]
}

time â† 0

PerFrame â† {
    DrawArena@
    DrawBoids Boids time
	time 1âŠ¸+â†©

    100|ğ•©+1
}r.draw._withCanvasâŸœblack

PerFrameâ€¢_While_(Â¬r.window.ShouldClose)âˆ˜0 r.window._openAs "Boid"
